# App Cards 功能测试指南

## 功能概述
App Cards 是一个应用操作指南系统，允许为不同的应用创建操作指南，并在启动应用时通过关键词匹配返回相应的操作步骤。

## 已实现的功能

### 1. 数据模型和管理
- ✅ AppCard 数据模型（包名、标题、关键词、内容）
- ✅ AppCardManager 管理类（增删改查、关键词匹配）
- ✅ 数据持久化（.md 文件存储在外部存储）

### 2. UI 界面
- ✅ 主界面新增 App Cards 栏目（位于 Endpoints 下方）
- ✅ 可折叠的列表视图
- ✅ 添加按钮
- ✅ 每个卡片显示标题和关键词
- ✅ 编辑和删除按钮

### 3. 编辑功能
- ✅ 编辑对话框（支持新建和编辑）
- ✅ 输入字段：包名、标题、关键词、内容
- ✅ 数据验证
- ✅ 保存和取消操作

### 4. MCP 工具集成
- ✅ 修改 `android.launch_app` 工具，添加 `keyword` 参数
- ✅ 启动应用时自动匹配并返回相关操作指南
- ✅ 支持模糊搜索和评分匹配

### 5. 默认示例
- ✅ 美团外卖订单查询示例（自动初始化）

## 测试步骤

### 1. 基本 UI 测试
1. 启动应用
2. 滚动到 "Connection Details" 区域
3. 找到 "Endpoints" 栏目
4. 确认 "App Cards" 栏目在 Endpoints 下方
5. 点击 "App Cards" 展开

**预期结果：**
- 应该看到折叠的 App Cards 栏目
- 点击后展开，显示 RecyclerView 或空状态提示
- 右侧有"添加"按钮

### 2. 查看默认示例
1. 展开 App Cards 栏目
2. 查看是否显示美团外卖订单示例

**预期结果：**
- 显示一个卡片
- 标题：查看最近的外卖订单
- 关键词：外卖, 订单, 查询, 历史, 配送

### 3. 添加新的 App Card
1. 点击"添加"按钮
2. 填写表单：
   - 包名: `com.example.app`
   - 标题: `测试应用操作`
   - 关键词: `测试, 操作`
   - 内容: `# 测试\n\n这是测试内容`
3. 点击"保存"

**预期结果：**
- 弹出编辑对话框
- 填写完成后保存成功
- 列表中显示新添加的卡片

### 4. 编辑 App Card
1. 点击某个卡片的"编辑"按钮
2. 修改标题或内容
3. 点击"保存"

**预期结果：**
- 弹出编辑对话框，预填充现有数据
- 修改后保存成功
- 列表中显示更新后的内容

### 5. 删除 App Card
1. 点击某个卡片的"删除"按钮
2. 确认删除

**预期结果：**
- 弹出确认对话框
- 确认后卡片从列表中移除

### 6. MCP 工具测试
使用 MCP 客户端测试 `android.launch_app` 工具：

```json
{
  "name": "android.launch_app",
  "arguments": {
    "package": "com.sankuai.meituan",
    "keyword": "外卖"
  }
}
```

**预期结果：**
- 启动美团应用
- 返回响应中包含 `app_cards` 字段
- 包含匹配的操作指南内容

### 7. 关键词匹配测试
测试不同的关键词匹配：

```json
// 测试1: 完全匹配
{"package": "com.sankuai.meituan", "keyword": "订单"}

// 测试2: 部分匹配
{"package": "com.sankuai.meituan", "keyword": "外"}

// 测试3: 多个匹配
{"package": "com.sankuai.meituan", "keyword": "查询"}

// 测试4: 无关键词（返回所有）
{"package": "com.sankuai.meituan"}
```

**预期结果：**
- 完全匹配的关键词评分最高
- 部分匹配也能返回结果
- 无关键词时返回该应用的所有卡片

### 8. 数据持久化测试
1. 添加几个 App Cards
2. 完全关闭应用
3. 重新启动应用
4. 展开 App Cards 栏目

**预期结果：**
- 之前添加的卡片仍然存在
- 数据没有丢失

### 9. 存储权限测试
1. 检查应用是否请求存储权限（Android 11 及以下）
2. 确认文件保存位置：`/Android/data/com.droidrun.portal/files/app_cards/`

**预期结果：**
- 权限请求正常（如需要）
- 文件正确保存在外部存储

## 已知限制

1. **Android 版本兼容性**：存储权限在 Android 13+ 可能不需要
2. **文件格式**：目前仅支持 .md 格式的文本内容
3. **搜索范围**：关键词搜索仅在标题、关键词列表和内容中进行
4. **并发安全**：多个 App Cards 管理器实例可能导致数据不一致

## 故障排查

### 问题1：列表不显示任何内容
**可能原因：**
- 初始化失败
- 存储权限未授予
- 文件读取错误

**解决方法：**
1. 检查 Logcat 日志，搜索 "AppCardManager"
2. 确认存储权限已授予
3. 手动调用 `initializeDefaultCards()`

### 问题2：MCP 工具不返回 app_cards
**可能原因：**
- 关键词不匹配
- 包名不正确
- AppCardManager 未正确初始化

**解决方法：**
1. 检查包名是否正确
2. 尝试不带关键词调用
3. 检查 Logcat 中的错误信息

### 问题3：编辑对话框无法保存
**可能原因：**
- 必填字段为空
- 存储权限问题
- 文件系统错误

**解决方法：**
1. 确保包名、标题和内容都已填写
2. 检查存储权限
3. 查看 Logcat 错误日志

## 下一步改进建议

1. **UI 增强**
   - 添加搜索功能
   - 支持按包名分组显示
   - 添加预览功能

2. **功能扩展**
   - 支持导入/导出 App Cards
   - 支持从网络下载模板
   - 添加使用统计

3. **性能优化**
   - 实现增量加载
   - 添加缓存机制
   - 优化搜索算法

4. **用户体验**
   - 添加拖拽排序
   - 支持批量操作
   - 添加使用教程